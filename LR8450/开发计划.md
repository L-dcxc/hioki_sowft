# LR8450 数据采集软件 ― 开发计划（Markdown 笔记）

## 1) 目标与范围（来自“开发目标.txt”）
- 运行环境：Windows 7 / 8 / 10 / 11
- 实时数据采集（≤5 台记录仪，经 LAN/USB）：
  - 逐一接收/显示/保存波形与数值，总记录采样数目标达 10M
  - 显示：波形（时间轴可分段）、数值（日志记录）、报警；可放大数值；可在独立监视窗口显示
  - Excel：实时或非实时传输，支持指定 Excel 模板
  - 测量时记录实时数据采集文件（LUW 格式），保存设备设置（LUS 格式）
  - 事件标记：测量期间可记录
- 波形显示支持：LUW/MEM 文件
  - 同时显示波形/数值/报警，最多通道数：2035（测量）+ 60（波形运算）
  - 分页（任意 10 页）、可滚动、A-B 光标、电压读数、硬拷贝
- 数据转换：LUW/MEM → CSV（逗号/空格/制表符）/ Excel 工作表 / hrp, hrp2
- 电池分析：三元/刀片电池温升比对、压降分析、mX+b、mAh 容量测试

## 2) 建议技术选型
- 语言/运行时：Python 3.11（可兼容 3.9+ 视依赖而定）
- 桌面 GUI：优先 PySide6（许可友好）；如您偏好可用 PyQt6/5
- 实时绘图：pyqtgraph（GPU 友好、实时性能好）
- 数据与缓存：pandas + 自研环形缓冲（分块/降采样）
- Excel：
  - 实时联动：xlwings（需本机安装 Excel）
  - 离线导出：openpyxl（生成 xlsx，不依赖 Excel）
- 打包发布：PyInstaller（单文件/目录，含驱动/资源）
- 配置/日志：YAML/JSON + logging（滚动日志、问题追踪）
- 文件格式/SDK：基于 LR8450 HTML SDK 指南；如提供 DLL/CLI/REST，以 Python 封装调用

## 3) 系统架构（模块化）
- DeviceManager：管理 ≤5 台设备的发现、连接（LAN/USB）、断线重连、拓扑维护
- DeviceClient：封装 LR8450 控制/订阅协议（开始/停止、通道/采样设置、数据块接收、事件标记、设置读写）
- AcquisitionPipeline：实时缓冲 → 分块持久化（LUW/CSV）→（可选）推送 Excel
- View 层（Qt）：
  - 波形视图：分段时间轴、分页（≤10 页）、滚动、A-B 光标、事件标记、硬拷贝
  - 数值/日志/报警视图：支持放大与独立监视窗口
- Converter：LUW/MEM → CSV/Excel/hrp/hrp2（基于 SDK/工具链）
- Analysis：温升比对、压降分析、线性回归 mX+b、容量（mAh）积分与规则
- Settings：保存/加载 LUS；工程归档（设置+数据打包）
- 并发模型：GUI 主线程 + 采集工作线程/异步 IO；跨线程队列（零拷贝/低 GC）

## 4) 里程碑与交付
- M0 预研（1-2 天）：
  - 跑通 SDK 示例/通信通道；确认 LUW/LUS/MEM 与 hrp/hrp2 转换路径
  - 输出《API 地图与能力清单》
- M1 MVP 单机采集（3-5 天）：
  - 连接 1 台设备，实时显示波形/数值；CSV 持久化；可选 Excel 模板实时写入
- M2 多机与稳定性（5-7 天）：
  - 扩展至 ≤5 台；断线重连；事件标记；LUS 保存/加载；LUW 测量文件记录
- M3 显示与转换（5-7 天）：
  - 分段时间轴/分页/A-B/硬拷贝；LUW/MEM 查看与 CSV/Excel/hrp/hrp2 转换
- M4 电池分析（5-7 天）：
  - 温升比对、压降、mX+b、mAh；报表与图表导出
- M5 性能与发布（3-5 天）：
  - 2000+ 通道、10M 点性能优化；安装包；用户手册与回归用例

（注：实际周期取决于 SDK 能力、设备/样例文件可用性）

## 5) 关键功能与验收标准（对齐 5.2.x）
- 5.2.2 实时采集：
  - 支持 LAN/USB 连接与并发 ≤5 台；单机断线 30 秒内自动重连
  - 实时曲线刷新 ≥20 FPS（典型 32 通道）或按通道数自适应降采样
  - Excel 实时写入（可选）延迟 <1 s；或离线导出完整一致
- 5.2.3 采集设置/监视器/保存：
  - 采集前可读取/设置通道、采样、报警阈值；设置可保存为 LUS 并再次加载
  - LUW 实时/后写均可；测量期间可插入事件标记
- 5.2.4 波形显示：
  - LUW/MEM 打开与显示；分页≤10 页、可滚动；A-B 光标读数；硬拷贝为 PNG/SVG
- 5.2.5 转换：
  - LUW/MEM → CSV（逗号/空格/制表符）、Excel 工作表、hrp/hrp2（若 SDK 提供）
- 5.2.6 电池分析：
  - 温升比对（指定通道组与时间窗）；压降曲线与关键点提取
  - mX+b 线性拟合（区间选择、R? 输出）；mAh 容量积分（采样步进/单位换算校验）

## 6) 风险与备选方案
- LUW/LUS/MEM/HRP 接口：若无公开库/CLI，则先以 CSV/Excel 主线交付，后续补齐解析
- USB 驱动/接口：优先走 LAN；USB 需确认官方 SDK/驱动与 Python 调用方式
- Excel 实时：若现场无 Excel 或版本不兼容，退化为离线导出
- 性能瓶颈：采用分块/降采样/批量写入；必要时使用 C 扩展/numba 优化

## 7) 性能策略
- 分块采集与写盘（如 1C5 s 窗口）；环形缓冲；可配置降采样
- 绘图采用 pyqtgraph 的下采样/分级渲染；大数据范围使用概览+局部细节
- I/O：CSV/Excel 批量写；避免逐点写入；日志异步

## 8) 待确认（请勾选/回复）
- [ ] GUI 框架选择：PySide6（建议）/ PyQt6/ PyQt5
- [ ] Excel 联动：实时（xlwings）/ 离线导出（openpyxl）/ 两者都要（分阶段）
- [ ] 连接优先：先做 LAN，USB 作为后续补充？
- [ ] 可提供资源：设备（IP/端口/通道）、示例 LUW/LUS/MEM 文件、hrp/hrp2 工具/SDK
- [ ] 优先级排序：是否先实现“采集+CSV/Excel+基础显示”，再做高级显示与分析

## 9) 下一步行动（我方）
1. 通读 LR8450 HTML SDK，整理《API 地图与能力清单》（通信、命令、文件格式）
2. 初始化最小 GUI 工程与单设备采集 Demo 的技术验证清单
3. 根据您的确认项，输出详细实施计划与时间表，并开始编码

## 10) 版本与交付
- 交付物：安装包（含依赖）、用户手册、验收用例、示例数据/模板、源代码（含测试）
- 版本策略：MVP → 功能迭代；每阶段提供 Release Notes 与回归结果

## 备注：关于 PyQt vs PySide
- 两者功能相近；PySide6 许可更宽松（LGPL），适合商业分发；如已有 PyQt 经验亦可选用

― 本计划为首版草案，等您确认“待确认”条目后，我将启动 M0 并提交下一步成果。
