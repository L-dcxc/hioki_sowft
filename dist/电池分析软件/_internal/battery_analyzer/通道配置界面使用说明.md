# 通道配置界面使用说明

## 🎯 功能概述

现在软件已经实现了**完整的通道配置界面**，支持详细的参数设置：

✅ **电压通道配置**：通道选择 + 量程设置  
✅ **温度通道配置**：通道选择 + 量程 + 热电偶类型 + INT/EXT  
✅ **自动应用配置**：连接设备时自动配置所有参数  
✅ **防止数据错乱**：先禁用所有通道，再启用需要的通道  

---

## 📋 如何使用

### 1. 打开通道配置对话框

点击主界面上的 **"通道配置"** 按钮

### 2. 配置三元电池通道

**电压通道：**
- **通道选择**：从CH2_1到CH2_30中选择（默认：CH2_1）
- **电压量程**：选择合适的量程
  - 10mV, 20mV, 100mV, 200mV
  - 1V, 2V, 10V, 20V, 100V
  - 默认：10V

**温度通道：**
- **通道选择**：从CH2_1到CH2_30中选择（默认：CH2_3）
- **温度量程**：选择合适的量程
  - 100°C, 500°C, 2000°C
  - 默认：500°C
- **热电偶类型**：选择热电偶类型
  - K型（默认，最常用，-200°C到1260°C）
  - J型, E型, T型, N型, R型, S型, C型
- **参考类型**：选择参考方式
  - INT（内部参考，默认）
  - EXT（外部参考）

### 3. 配置刀片电池通道

配置方式与三元电池相同：
- 电压通道（默认：CH2_4，10V量程）
- 温度通道（默认：CH2_5，500°C，K型，INT）

### 4. 保存配置

点击 **"保存配置"** 按钮

**注意事项：**
- ✅ 不能选择重复的通道
- ✅ 如果设备已连接，需要重新连接以应用新配置
- ✅ 配置会自动保存到波形文件中

---

## 🔧 支持的参数

### 电压量程（单位：V）

| 显示 | 实际值 | 适用范围 |
|------|--------|----------|
| 10mV | 0.01 | 0-10mV |
| 20mV | 0.02 | 0-20mV |
| 100mV | 0.1 | 0-100mV |
| 200mV | 0.2 | 0-200mV |
| 1V | 1.0 | 0-1V |
| 2V | 2.0 | 0-2V |
| **10V** | **10.0** | **0-10V（默认）** |
| 20V | 20.0 | 0-20V |
| 100V | 100.0 | 0-100V |

**建议：**
- 锂电池电压测量：使用 **10V** 量程
- 单节电池：使用 **2V** 或 **10V** 量程
- 高压电池包：使用 **20V** 或 **100V** 量程

### 温度量程（单位：°C）

| 显示 | 实际值 | 适用范围 |
|------|--------|----------|
| 100°C | 100 | 0-100°C |
| **500°C** | **500** | **0-500°C（默认）** |
| 2000°C | 2000 | 0-2000°C |

**建议：**
- 电池温升测试：使用 **500°C** 量程（覆盖0-260°C）
- 高温测试：使用 **2000°C** 量程

### 热电偶类型

| 类型 | 温度范围 | 特点 | 推荐场景 |
|------|----------|------|----------|
| **K型** | **-200°C到1260°C** | **最常用，精度高** | **电池测试（推荐）** |
| J型 | -40°C到750°C | 适用于还原性气氛 | 工业应用 |
| E型 | -200°C到900°C | 灵敏度高 | 低温测量 |
| T型 | -200°C到350°C | 稳定性好 | 低温精密测量 |
| N型 | -200°C到1300°C | 抗氧化性好 | 高温测量 |
| R型 | 0°C到1600°C | 高精度 | 高温精密测量 |
| S型 | 0°C到1600°C | 高精度 | 高温精密测量 |
| C型 | 0°C到2300°C | 超高温 | 特殊高温应用 |

**建议：**
- 电池温升测试：使用 **K型**（默认）

### INT/EXT（参考类型）

| 类型 | 说明 | 推荐场景 |
|------|------|----------|
| **INT** | **内部参考（默认）** | **一般测试** |
| EXT | 外部参考 | 高精度测试 |

**说明：**
- **INT（内部参考）**：使用设备内部的参考端温度补偿，适用于大多数场景
- **EXT（外部参考）**：使用外部参考端，适用于高精度测量

---

## 🔍 配置示例

### 示例1：标准电池测试配置（默认）

```
三元电池：
  电压通道：CH2_1，量程10V
  温度通道：CH2_3，量程500°C，K型热电偶，INT参考

刀片电池：
  电压通道：CH2_4，量程10V
  温度通道：CH2_5，量程500°C，K型热电偶，INT参考
```

**适用场景：**
- 标准锂电池测试
- 电压范围：0-10V
- 温度范围：0-260°C

### 示例2：高压电池包测试

```
三元电池：
  电压通道：CH2_1，量程20V
  温度通道：CH2_3，量程500°C，K型热电偶，INT参考

刀片电池：
  电压通道：CH2_4，量程20V
  温度通道：CH2_5，量程500°C，K型热电偶，INT参考
```

**适用场景：**
- 高压电池包测试
- 电压范围：0-20V

### 示例3：低温精密测试

```
三元电池：
  电压通道：CH2_1，量程10V
  温度通道：CH2_3，量程100°C，T型热电偶，INT参考

刀片电池：
  电压通道：CH2_4，量程10V
  温度通道：CH2_5，量程100°C，T型热电偶，INT参考
```

**适用场景：**
- 低温环境测试
- 温度范围：0-100°C
- 需要高精度温度测量

---

## ⚠️ 重要注意事项

### 1. 通道不能重复

❌ **错误示例：**
```
三元电池电压：CH2_1
三元电池温度：CH2_1  ← 错误！与电压通道重复
```

✅ **正确示例：**
```
三元电池电压：CH2_1
三元电池温度：CH2_3  ← 正确！不同的通道
```

### 2. 重新连接以应用配置

修改配置后，如果设备已连接：
1. 断开设备连接
2. 重新连接设备
3. 新配置会自动应用到设备

### 3. 量程选择建议

**电压量程：**
- 选择略大于实际测量值的量程
- 例如：测量3.7V电池，选择10V量程
- 避免选择过小的量程导致超量程

**温度量程：**
- 电池测试通常选择500°C量程
- 覆盖0-260°C的测试范围

### 4. 数据错乱问题已修复

✅ **现在的行为：**
- 连接设备时，先禁用所有通道
- 然后只启用配置的4个通道
- 数据不会错乱

❌ **之前的问题：**
- 只启用新通道，不禁用旧通道
- 导致设备采集了多余的通道
- 数据索引错位

---

## 🧪 测试建议

### 测试步骤

1. **打开软件**
   ```bash
   python battery_analyzer/main.py
   ```

2. **配置通道**
   - 点击"通道配置"按钮
   - 设置电压量程为10V
   - 设置温度量程为500°C
   - 设置热电偶类型为K型
   - 设置参考类型为INT
   - 保存配置

3. **连接设备**
   - 点击"连接设备"按钮
   - 选择TCP或USB连接
   - 观察控制台输出，确认通道配置成功

4. **开始测试**
   - 点击"开始采集"按钮
   - 观察波形显示
   - 检查数据是否正确

5. **验证配置**
   - 在设备上检查通道配置
   - 确认量程、热电偶类型等参数正确

---

## 📊 配置文件格式

配置会保存在波形文件（.json）中：

```json
{
  "channel_config": {
    "ternary_voltage": {
      "channel": "CH2_1",
      "type": "VOLTAGE",
      "range": 10.0
    },
    "ternary_temp": {
      "channel": "CH2_3",
      "type": "TEMPERATURE",
      "range": 500,
      "thermocouple": "K",
      "int_ext": "INT"
    },
    "blade_voltage": {
      "channel": "CH2_4",
      "type": "VOLTAGE",
      "range": 10.0
    },
    "blade_temp": {
      "channel": "CH2_5",
      "type": "TEMPERATURE",
      "range": 500,
      "thermocouple": "K",
      "int_ext": "INT"
    }
  }
}
```

---

## 🎉 总结

**通道配置界面已完全实现！**

✅ **支持的功能：**
- 通道选择（CH2_1到CH2_30）
- 电压量程设置（10mV到100V）
- 温度量程设置（100°C到2000°C）
- 热电偶类型设置（K/J/E/T/N/R/S/C）
- INT/EXT参考类型设置
- 自动应用配置到设备
- 防止数据错乱

✅ **已修复的问题：**
- 数据错乱问题（先禁用所有通道）
- 缺少详细参数配置

**现在你可以：**
1. 通过界面配置所有通道参数
2. 自动应用配置到设备
3. 享受正确的数据采集

**如果还有任何问题，随时告诉我！** 🚀

