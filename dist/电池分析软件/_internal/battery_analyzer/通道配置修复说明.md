# é€šé“é…ç½®ä¿®å¤è¯´æ˜

## ğŸ” é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šé€šé“æ•°æ®é”™ä¹± âœ… å·²ä¿®å¤

#### **é—®é¢˜æè¿°**
```
è®¾å¤‡åŸæœ‰é€šé“ï¼šCH2_1, CH2_2, CH2_3, CH2_4 (å·²å¯ç”¨)
è½¯ä»¶é…ç½®é€šé“ï¼šCH2_1, CH2_2, CH2_3, CH2_5 (å¯ç”¨)
å®é™…ç»“æœï¼š    CH2_1, CH2_2, CH2_3, CH2_4, CH2_5 (å…¨éƒ¨å¯ç”¨) âŒ

å¯¼è‡´é—®é¢˜ï¼š
- è®¾å¤‡é‡‡é›†äº†5ä¸ªé€šé“çš„æ•°æ®
- è½¯ä»¶åªè¯»å–4ä¸ªé€šé“
- æ•°æ®ç´¢å¼•é”™ä½
- CH2_4çš„æ•°æ®è¢«è¯»åˆ°CH2_1
- CH2_3çš„æ•°æ®è¢«è¯»åˆ°CH2_4
- å‡ºç°å¼‚å¸¸æ•°æ®å€¼ï¼ˆå¦‚300å¤šï¼‰
```

#### **æ ¹æœ¬åŸå› **
æ—§çš„`configure_channels()`æ–¹æ³•åªæ˜¯**å¯ç”¨**æ–°é€šé“ï¼Œä½†æ²¡æœ‰**ç¦ç”¨**æ—§é€šé“ï¼

#### **è§£å†³æ–¹æ¡ˆ**
1. **æ–°å¢æ–¹æ³•**ï¼š`disable_all_channels(modules)` - ç¦ç”¨æŒ‡å®šæ¨¡å—çš„æ‰€æœ‰é€šé“
2. **ä¿®æ”¹é€»è¾‘**ï¼šé…ç½®é€šé“å‰ï¼Œå…ˆç¦ç”¨æ‰€æœ‰é€šé“ï¼Œç„¶ååªå¯ç”¨éœ€è¦çš„é€šé“
3. **å‚æ•°æ§åˆ¶**ï¼š`disable_others=True` å‚æ•°æ§åˆ¶æ˜¯å¦å…ˆç¦ç”¨å…¶ä»–é€šé“

#### **ä¿®å¤åçš„æµç¨‹**
```
1. è¿æ¥è®¾å¤‡æˆåŠŸ
   â†“
2. ç¦ç”¨æ‰€æœ‰é€šé“ï¼ˆCH2_1 åˆ° CH2_30ï¼‰
   â†“
3. åªå¯ç”¨éœ€è¦çš„4ä¸ªé€šé“
   - CH2_1 (ä¸‰å…ƒç”µå‹)
   - CH2_3 (ä¸‰å…ƒæ¸©åº¦)
   - CH2_4 (åˆ€ç‰‡ç”µå‹)
   - CH2_5 (åˆ€ç‰‡æ¸©åº¦)
   â†“
4. è®¾å¤‡åªé‡‡é›†è¿™4ä¸ªé€šé“
   â†“
5. æ•°æ®ç´¢å¼•æ­£ç¡®ï¼Œä¸å†é”™ä¹± âœ…
```

---

### é—®é¢˜2ï¼šç¼ºå°‘è¯¦ç»†çš„é€šé“å‚æ•°é…ç½® âœ… å·²å®Œå–„

#### **éœ€æ±‚**
æ ¹æ®ä½ çš„æè¿°ï¼Œéœ€è¦æ”¯æŒï¼š

**æ¸©åº¦é€šé“å‚æ•°ï¼š**
- é‡ç¨‹ï¼š100, 500, 2000 (Â°C)
- çƒ­ç”µå¶ç±»å‹ï¼šK, J, E, T, N, R, S, C
- INT/EXTï¼šå†…éƒ¨/å¤–éƒ¨å‚è€ƒ

**ç”µå‹é€šé“å‚æ•°ï¼š**
- é‡ç¨‹ï¼š10mV, 20mV, 100mV, 200mV, 1V, 2V, 10V, 20V, 100V, 1-5V

#### **è§£å†³æ–¹æ¡ˆ**
æ‰©å±•äº†`configure_channel()`æ–¹æ³•ï¼Œæ”¯æŒè¯¦ç»†å‚æ•°ï¼š

```python
def configure_channel(
    channel: str,
    enabled: bool = True,
    channel_type: str = "VOLTAGE",  # "VOLTAGE" æˆ– "TEMPERATURE"
    range_value: float = None,      # é‡ç¨‹å€¼
    thermocouple_type: str = None,  # çƒ­ç”µå¶ç±»å‹ (K/J/E/T/N/R/S/C)
    int_ext: str = None             # INT æˆ– EXT
)
```

#### **SCPIå‘½ä»¤æ˜ å°„**
```python
# 1. å¯ç”¨/ç¦ç”¨é€šé“
:UNIT:STORe CH2_1,ON/OFF

# 2. è®¾ç½®é‡ç¨‹
:UNIT:RANGe CH2_1,10.0          # ç”µå‹ï¼š10V
:UNIT:RANGe CH2_3,500           # æ¸©åº¦ï¼š500Â°C

# 3. è®¾ç½®çƒ­ç”µå¶ç±»å‹ï¼ˆæ¸©åº¦é€šé“ï¼‰
:SCALing:UNIT CH2_3,TC_K        # Kå‹çƒ­ç”µå¶

# 4. è®¾ç½®å†…éƒ¨/å¤–éƒ¨å‚è€ƒï¼ˆæ¸©åº¦é€šé“ï¼‰
:SCALing:REFerence CH2_3,INT    # å†…éƒ¨å‚è€ƒ
```

---

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `battery_analyzer/core/lr8450_client.py`

#### **æ–°å¢æ–¹æ³•**

**1) `disable_all_channels(modules)`**
```python
def disable_all_channels(self, modules: List[int] = None) -> bool:
    """ç¦ç”¨æŒ‡å®šæ¨¡å—çš„æ‰€æœ‰é€šé“ï¼ˆé˜²æ­¢æ•°æ®é”™ä¹±ï¼‰
    
    Args:
        modules: è¦ç¦ç”¨çš„æ¨¡å—åˆ—è¡¨ï¼Œå¦‚ [2] è¡¨ç¤ºåªç¦ç”¨æ¨¡å—2
                å¦‚æœä¸ºNoneï¼Œåˆ™ç¦ç”¨æ‰€æœ‰æ¨¡å—ï¼ˆ1-4ï¼‰
    """
    # ç¦ç”¨æ¯ä¸ªæ¨¡å—çš„30ä¸ªé€šé“
    for module in modules:
        for ch in range(1, 31):
            channel = f"CH{module}_{ch}"
            self.write(f":UNIT:STORe {channel},OFF")
```

**2) æ‰©å±• `configure_channel()`**
```python
def configure_channel(
    self,
    channel: str,
    enabled: bool = True,
    channel_type: str = "VOLTAGE",      # æ–°å¢ï¼šé€šé“ç±»å‹
    range_value: float = None,
    thermocouple_type: str = None,      # æ–°å¢ï¼šçƒ­ç”µå¶ç±»å‹
    int_ext: str = None                 # æ–°å¢ï¼šINT/EXT
) -> bool:
    """é…ç½®å•ä¸ªé€šé“ï¼ˆæ”¯æŒè¯¦ç»†å‚æ•°ï¼‰"""
    
    # 1. å¯ç”¨/ç¦ç”¨é€šé“
    self.write(f":UNIT:STORe {channel},{'ON' if enabled else 'OFF'}")
    
    # 2. è®¾ç½®é‡ç¨‹
    if range_value is not None:
        self.write(f":UNIT:RANGe {channel},{range_value}")
    
    # 3. è®¾ç½®çƒ­ç”µå¶ç±»å‹ï¼ˆæ¸©åº¦é€šé“ï¼‰
    if channel_type == "TEMPERATURE" and thermocouple_type:
        self.write(f":SCALing:UNIT {channel},TC_{thermocouple_type}")
    
    # 4. è®¾ç½®INT/EXTï¼ˆæ¸©åº¦é€šé“ï¼‰
    if channel_type == "TEMPERATURE" and int_ext:
        self.write(f":SCALing:REFerence {channel},{int_ext}")
```

**3) æ‰©å±• `configure_channels()`**
```python
def configure_channels(
    self,
    channels: List[str],
    disable_others: bool = True,        # æ–°å¢ï¼šæ˜¯å¦å…ˆç¦ç”¨å…¶ä»–é€šé“
    channel_configs: List[Dict] = None  # æ–°å¢ï¼šè¯¦ç»†é…ç½®åˆ—è¡¨
) -> bool:
    """æ‰¹é‡é…ç½®å¤šä¸ªé€šé“ï¼ˆæ”¯æŒè¯¦ç»†å‚æ•°ï¼‰"""
    
    # 1. å…ˆç¦ç”¨æ‰€æœ‰é€šé“ï¼ˆé˜²æ­¢æ•°æ®é”™ä¹±ï¼‰
    if disable_others:
        self.disable_all_channels()
    
    # 2. é…ç½®æŒ‡å®šçš„é€šé“
    if channel_configs:
        # ä½¿ç”¨è¯¦ç»†é…ç½®
        for config in channel_configs:
            self.configure_channel(
                channel=config['channel'],
                channel_type=config.get('type', 'VOLTAGE'),
                range_value=config.get('range'),
                thermocouple_type=config.get('thermocouple'),
                int_ext=config.get('int_ext')
            )
    else:
        # ä½¿ç”¨é»˜è®¤é…ç½®
        for channel in channels:
            self.configure_channel(channel, enabled=True)
```

### 2. `battery_analyzer/ui/main_window.py`

#### **ä¿®æ”¹è¿æ¥è®¾å¤‡æ—¶çš„é€šé“é…ç½®**

**æ—§ä»£ç ï¼š**
```python
channels = ['CH2_1', 'CH2_3', 'CH2_4', 'CH2_5']
config_success = self.device_client.configure_channels(
    channels, 
    range_value=10.0
)
```

**æ–°ä»£ç ï¼š**
```python
# å‡†å¤‡è¯¦ç»†é…ç½®
channel_configs = [
    {
        'channel': 'CH2_1',
        'type': 'VOLTAGE',
        'range': 10.0  # 10Vé‡ç¨‹
    },
    {
        'channel': 'CH2_3',
        'type': 'TEMPERATURE',
        'range': 500,  # 500Â°Cé‡ç¨‹
        'thermocouple': 'K',  # Kå‹çƒ­ç”µå¶
        'int_ext': 'INT'  # å†…éƒ¨å‚è€ƒ
    },
    {
        'channel': 'CH2_4',
        'type': 'VOLTAGE',
        'range': 10.0
    },
    {
        'channel': 'CH2_5',
        'type': 'TEMPERATURE',
        'range': 500,
        'thermocouple': 'K',
        'int_ext': 'INT'
    },
]

# é…ç½®é€šé“ï¼ˆå…ˆç¦ç”¨æ‰€æœ‰é€šé“ï¼Œé˜²æ­¢æ•°æ®é”™ä¹±ï¼‰
config_success = self.device_client.configure_channels(
    channels=[cfg['channel'] for cfg in channel_configs],
    disable_others=True,  # âœ… å…ˆç¦ç”¨å…¶ä»–é€šé“
    channel_configs=channel_configs
)
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåŸºæœ¬é…ç½®ï¼ˆç”µå‹é€šé“ï¼‰

```python
# é…ç½®å•ä¸ªç”µå‹é€šé“
client.configure_channel(
    channel='CH2_1',
    enabled=True,
    channel_type='VOLTAGE',
    range_value=10.0  # 10Vé‡ç¨‹
)
```

### ç¤ºä¾‹2ï¼šæ¸©åº¦é€šé“é…ç½®

```python
# é…ç½®å•ä¸ªæ¸©åº¦é€šé“
client.configure_channel(
    channel='CH2_3',
    enabled=True,
    channel_type='TEMPERATURE',
    range_value=500,           # 500Â°Cé‡ç¨‹
    thermocouple_type='K',     # Kå‹çƒ­ç”µå¶
    int_ext='INT'              # å†…éƒ¨å‚è€ƒ
)
```

### ç¤ºä¾‹3ï¼šæ‰¹é‡é…ç½®ï¼ˆé˜²æ­¢æ•°æ®é”™ä¹±ï¼‰

```python
# å‡†å¤‡é…ç½®
configs = [
    {'channel': 'CH2_1', 'type': 'VOLTAGE', 'range': 10.0},
    {'channel': 'CH2_3', 'type': 'TEMPERATURE', 'range': 500, 'thermocouple': 'K'},
]

# æ‰¹é‡é…ç½®ï¼ˆå…ˆç¦ç”¨æ‰€æœ‰é€šé“ï¼‰
client.configure_channels(
    channels=['CH2_1', 'CH2_3'],
    disable_others=True,  # âœ… å…³é”®ï¼šå…ˆç¦ç”¨å…¶ä»–é€šé“
    channel_configs=configs
)
```

---

## ğŸ“Š æ”¯æŒçš„å‚æ•°å€¼

### ç”µå‹é‡ç¨‹ï¼ˆå•ä½ï¼šVï¼‰
```python
range_values = [
    0.01,   # 10mV
    0.02,   # 20mV
    0.1,    # 100mV
    0.2,    # 200mV
    1,      # 1V
    2,      # 2V
    10,     # 10V
    20,     # 20V
    100,    # 100V
    # 1-5V éœ€è¦ç‰¹æ®Šè®¾ç½®
]
```

### æ¸©åº¦é‡ç¨‹ï¼ˆå•ä½ï¼šÂ°Cï¼‰
```python
range_values = [
    100,    # 100Â°C
    500,    # 500Â°C
    2000,   # 2000Â°C
]
```

### çƒ­ç”µå¶ç±»å‹
```python
thermocouple_types = [
    'K',  # Kå‹ï¼ˆæœ€å¸¸ç”¨ï¼‰
    'J',  # Jå‹
    'E',  # Eå‹
    'T',  # Tå‹
    'N',  # Nå‹
    'R',  # Rå‹
    'S',  # Så‹
    'C',  # Cå‹
]
```

### INT/EXTï¼ˆå†…éƒ¨/å¤–éƒ¨å‚è€ƒï¼‰
```python
int_ext_values = [
    'INT',  # å†…éƒ¨å‚è€ƒï¼ˆå¸¸ç”¨ï¼‰
    'EXT',  # å¤–éƒ¨å‚è€ƒ
]
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ•°æ®é”™ä¹±é—®é¢˜
**å¿…é¡»å…ˆç¦ç”¨æ‰€æœ‰é€šé“ï¼Œç„¶ååªå¯ç”¨éœ€è¦çš„é€šé“ï¼**

```python
# âŒ é”™è¯¯åšæ³•ï¼šåªå¯ç”¨æ–°é€šé“
client.configure_channels(channels, disable_others=False)
# ç»“æœï¼šæ—§é€šé“ä»ç„¶å¯ç”¨ï¼Œå¯¼è‡´æ•°æ®é”™ä¹±

# âœ… æ­£ç¡®åšæ³•ï¼šå…ˆç¦ç”¨æ‰€æœ‰é€šé“
client.configure_channels(channels, disable_others=True)
# ç»“æœï¼šåªæœ‰æŒ‡å®šçš„é€šé“å¯ç”¨ï¼Œæ•°æ®æ­£ç¡®
```

### 2. é…ç½®é¡ºåº
```
1. è¿æ¥è®¾å¤‡
2. ç¦ç”¨æ‰€æœ‰é€šé“
3. é…ç½®éœ€è¦çš„é€šé“ï¼ˆå¯ç”¨ + å‚æ•°è®¾ç½®ï¼‰
4. å¯åŠ¨æ•°æ®é‡‡é›†
```

### 3. æ€§èƒ½ä¼˜åŒ–
ç¦ç”¨æ‰€æœ‰é€šé“å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼ˆ120ä¸ªé€šé“ Ã— 0.005ç§’ = 0.6ç§’ï¼‰

å¯ä»¥åªç¦ç”¨ä½¿ç”¨çš„æ¨¡å—ï¼š
```python
# åªç¦ç”¨æ¨¡å—2çš„é€šé“
client.disable_all_channels(modules=[2])
```

### 4. SCPIå‘½ä»¤å…¼å®¹æ€§
ä¸åŒç‰ˆæœ¬çš„LR8450å¯èƒ½æ”¯æŒçš„SCPIå‘½ä»¤ç•¥æœ‰ä¸åŒã€‚å¦‚æœæŸäº›å‘½ä»¤ä¸æ”¯æŒï¼š
- `:SCALing:UNIT` - çƒ­ç”µå¶ç±»å‹è®¾ç½®
- `:SCALing:REFerence` - INT/EXTè®¾ç½®

ç¨‹åºä¼šå¿½ç•¥é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œï¼Œä¸å½±å“åŸºæœ¬åŠŸèƒ½ã€‚

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•1ï¼šæ•°æ®é”™ä¹±ä¿®å¤éªŒè¯

1. **å‡†å¤‡å·¥ä½œï¼š**
   - åœ¨è®¾å¤‡ä¸Šæ‰‹åŠ¨å¯ç”¨CH2_1, CH2_2, CH2_3, CH2_4

2. **æµ‹è¯•æ­¥éª¤ï¼š**
   - è½¯ä»¶è¿æ¥è®¾å¤‡
   - è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤ç¦ç”¨äº†æ‰€æœ‰é€šé“
   - è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤åªå¯ç”¨äº†4ä¸ªé€šé“
   - å¼€å§‹æ•°æ®é‡‡é›†
   - æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®

3. **é¢„æœŸç»“æœï¼š**
   - âœ… æ•°æ®ä¸å†é”™ä¹±
   - âœ… CH2_1æ˜¾ç¤ºæ­£ç¡®çš„ç”µå‹å€¼
   - âœ… CH2_3æ˜¾ç¤ºæ­£ç¡®çš„æ¸©åº¦å€¼
   - âœ… æ²¡æœ‰å¼‚å¸¸æ•°æ®ï¼ˆå¦‚300å¤šï¼‰

### æµ‹è¯•2ï¼šè¯¦ç»†å‚æ•°é…ç½®éªŒè¯

1. **æµ‹è¯•æ¸©åº¦é€šé“ï¼š**
   - é…ç½®CH2_3ä¸ºæ¸©åº¦é€šé“
   - è®¾ç½®é‡ç¨‹500Â°C
   - è®¾ç½®Kå‹çƒ­ç”µå¶
   - æ£€æŸ¥è®¾å¤‡ä¸Šçš„é…ç½®æ˜¯å¦æ­£ç¡®

2. **æµ‹è¯•ç”µå‹é€šé“ï¼š**
   - é…ç½®CH2_1ä¸ºç”µå‹é€šé“
   - è®¾ç½®é‡ç¨‹10V
   - æ£€æŸ¥è®¾å¤‡ä¸Šçš„é…ç½®æ˜¯å¦æ­£ç¡®

---

## ğŸ‰ æ€»ç»“

### å·²ä¿®å¤çš„é—®é¢˜

âœ… **é€šé“æ•°æ®é”™ä¹±** - é€šè¿‡å…ˆç¦ç”¨æ‰€æœ‰é€šé“è§£å†³  
âœ… **ç¼ºå°‘è¯¦ç»†å‚æ•°** - æ”¯æŒæ¸©åº¦/ç”µå‹ã€é‡ç¨‹ã€çƒ­ç”µå¶ç±»å‹ã€INT/EXT  
âœ… **é…ç½®ä¸å®Œæ•´** - å®Œæ•´çš„SCPIå‘½ä»¤å®ç°  

### æ–°å¢åŠŸèƒ½

âœ… `disable_all_channels()` - ç¦ç”¨æ‰€æœ‰é€šé“  
âœ… æ‰©å±•çš„ `configure_channel()` - æ”¯æŒè¯¦ç»†å‚æ•°  
âœ… æ‰©å±•çš„ `configure_channels()` - æ‰¹é‡é…ç½® + é˜²æ­¢æ•°æ®é”™ä¹±  

### ä½¿ç”¨å»ºè®®

1. **æ˜å¤©è®¾å¤‡åˆ°è´§åï¼Œç«‹å³æµ‹è¯•æ•°æ®é”™ä¹±ä¿®å¤**
2. **éªŒè¯æ¸©åº¦é€šé“çš„çƒ­ç”µå¶ç±»å‹è®¾ç½®**
3. **æ£€æŸ¥INT/EXTå‚æ•°æ˜¯å¦ç”Ÿæ•ˆ**
4. **å¦‚æœæŸäº›SCPIå‘½ä»¤ä¸æ”¯æŒï¼Œå‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šè°ƒæ•´**

---

**ç°åœ¨é€šé“é…ç½®åŠŸèƒ½å·²ç»å®Œå–„ï¼Œæ•°æ®é”™ä¹±é—®é¢˜å·²ç»ä¿®å¤ï¼** ğŸš€

